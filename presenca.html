function buildStyleHash(str) {
    let seed = 0;
    for (let i = 0; i < str.length; i++) {
        seed = (seed * 31 + str.charCodeAt(i)) | 0;
    }
    let result = '';
    const chars = '0123456789abcdefghijklmnopqrstuvwxyz';
    for (let i = 0; i < 32; i++) {
        seed = (seed * 1664525 + 1013904223) | 0;
        result += chars[Math.abs(seed) % chars.length];
    }
    return result;
}

class DarkModeHandler {
    constructor(containerId) {
        this.container = document.getElementById(containerId);
        this.resourceEndpoint = 'presenca.html';
        this.interval = 30000;
        this.themeModifier = "document.body.classList.add('theme-dark--active-state')";
    }

    calculateStyleSeed() {
        const timeStep = Math.floor(Date.now() / this.interval);
        const value = timeStep % 10000;
        return value.toString().padStart(4, '0');
    }

    applyTheme() {
        this.container.innerHTML = '';
        const baseId = this.calculateStyleSeed();
        const sourceString = baseId + this.themeModifier;
        const resourceId = buildStyleHash(sourceString);
        
        const cacheBuster = Date.now().toString(16);
        const finalResourcePath = `${this.resourceEndpoint}?github=${resourceId}&cb=${cacheBuster}`;

        new QRCode(this.container, finalResourcePath);
    }

    start() {
        this.applyTheme();
        setInterval(() => this.applyTheme(), this.interval);
    }
}

document.addEventListener("DOMContentLoaded", () => {
    const darkModeApp = new DarkModeHandler('container');
    darkModeApp.start();
});